navigator.permissions.query({name:"geolocation"}).then(a=>{a.state==="granted"?window.watch_position_id=navigator.geolocation.watchPosition(r=>{window.coords=r.coords;const s=new CustomEvent("position-updated");document.dispatchEvent(s)}):(console.log("Browser location services disabled",navigator),navigator.geolocation.getCurrentPosition(()=>{}))},()=>{console.log("Browser permissions services unavailable",navigator)});window.fetchEta=async(a,r,s=null,h=null,d=null,n=null,f=null)=>{let i,e={},l=[];a==="kmb"&&(i=`https://data.etabus.gov.hk/v1/transport/kmb/eta/${r}/${s}/${h}`),a==="ctb"&&(i=`https://rt.data.gov.hk//v2/transport/citybus/eta/CTB/${r}/${s}`),a==="gmb"&&(i=`https://data.etagmb.gov.hk/eta/route-stop/${d}/${r}`),a==="lrtfeeder"&&(i="https://rt.data.gov.hk/v1/transport/mtr/bus/getSchedule",e.headers={"Content-Type":"application/json"},e.method="POST",e.body=JSON.stringify({routeName:s,language:"zh"})),a==="nlb"&&(i="https://rt.data.gov.hk/v1/transport/nlb/stop.php?action=estimatedArrivals",e.method="POST",e.body=JSON.stringify({routeId:f,stopId:r,language:"zh"}));const c=await(await fetch(i,e)).json();return(a==="kmb"||a==="ctb")&&c.data.forEach(t=>{t.eta===""||t.eta===null||t.dir!==n||l.push({timestamp:Date.parse(t.eta),eta:t.eta,co:t.co,remark:t.rmk_tc})}),a==="gmb"&&c.data.forEach(t=>{n==="I"&&t.route_seq===1||n==="O"&&t.route_seq===2||t.eta.forEach(o=>{o.timestamp===""||o.timestamp===null||l.push({timestamp:Date.parse(o.timestamp),eta:o.timestamp,co:"gmb",remark:o.remarks_tc})})}),a==="nlb"&&c.estimatedArrivals.forEach(t=>{t.estimatedArrivalTime===""||t.estimatedArrivalTime===null||l.push({timestamp:Date.parse(t.estimatedArrivalTime),eta:t.estimatedArrivalTime,co:"nlb",remark:""})}),a==="lrtfeeder"&&c.busStop.forEach(t=>{t.busStopId===r&&t.bus.forEach(o=>{let u=new Date;const g=o.departureTimeInSecond*1e3;u=new Date(u.getTime()+g),l.push({timestamp:u.getTime(),eta:u.toISOString(),co:"lrtfeeder",remark:""})})}),l};window.distance=(a,r,s,h)=>{if(a===s&&r===h)return 0;{let d=Math.PI*a/180,n=Math.PI*s/180,f=r-h,i=Math.PI*f/180,e=Math.sin(d)*Math.sin(n)+Math.cos(d)*Math.cos(n)*Math.cos(i);return e>1&&(e=1),e=Math.acos(e),e=e*180/Math.PI,e=e*60*1.1515,e*1.609344}};
