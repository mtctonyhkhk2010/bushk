window.fetchEta=async(a,r,h=null,d=null,f=null,l=null,m=null)=>{let s,e={},n=[];a==="kmb"&&(s=`https://data.etabus.gov.hk/v1/transport/kmb/eta/${r}/${h}/${d}`),a==="ctb"&&(s=`https://rt.data.gov.hk//v2/transport/citybus/eta/CTB/${r}/${h}`),a==="gmb"&&(s=`https://data.etagmb.gov.hk/eta/route-stop/${f}/${r}`),a==="lrtfeeder"&&(s="https://rt.data.gov.hk/v1/transport/mtr/bus/getSchedule",e.headers={"Content-Type":"application/json"},e.method="POST",e.body=JSON.stringify({routeName:h,language:"zh"})),a==="nlb"&&(s="https://rt.data.gov.hk/v1/transport/nlb/stop.php?action=estimatedArrivals",e.method="POST",e.body=JSON.stringify({routeId:m,stopId:r,language:"zh"}));const o=await(await fetch(s,e)).json();return(a==="kmb"||a==="ctb")&&o.data.forEach(t=>{t.eta===""||t.eta===null||t.dir!==l||n.push({timestamp:Date.parse(t.eta),eta:t.eta,co:t.co,remark:t.rmk_tc})}),a==="gmb"&&o.data.forEach(t=>{l==="I"&&t.route_seq===1||l==="O"&&t.route_seq===2||t.eta.forEach(i=>{i.timestamp===""||i.timestamp===null||n.push({timestamp:Date.parse(i.timestamp),eta:i.timestamp,co:"gmb",remark:i.remarks_tc})})}),a==="nlb"&&o.estimatedArrivals.forEach(t=>{t.estimatedArrivalTime===""||t.estimatedArrivalTime===null||n.push({timestamp:Date.parse(t.estimatedArrivalTime),eta:t.estimatedArrivalTime,co:"nlb",remark:""})}),a==="lrtfeeder"&&o.busStop.forEach(t=>{t.busStopId===r&&t.bus.forEach(i=>{let u=new Date;const p=i.departureTimeInSecond*1e3;u=new Date(u.getTime()+p),n.push({timestamp:u.getTime(),eta:u.toISOString(),co:"lrtfeeder",remark:""})})}),n};window.distance=(a,r,h,d)=>{if(a===h&&r===d)return 0;{let f=Math.PI*a/180,l=Math.PI*h/180,m=r-d,s=Math.PI*m/180,e=Math.sin(f)*Math.sin(l)+Math.cos(f)*Math.cos(l)*Math.cos(s);return e>1&&(e=1),e=Math.acos(e),e=e*180/Math.PI,e=e*60*1.1515,e*1.609344}};
